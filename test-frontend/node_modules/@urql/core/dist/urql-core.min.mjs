import{visit as e}from"graphql/language/visitor.mjs";import{Kind as n}from"graphql/language/kinds.mjs";import{print as r}from"graphql/language/printer.mjs";import{k as t,_ as o,s as i,C as u,m as c,a as s,b as p,c as l,d as y,e as d,f as k}from"./c650862e.min.mjs";export{C as CombinedError,f as createRequest,h as getOperationName,a as makeErrorResult,m as makeResult,g as stringifyVariables}from"./c650862e.min.mjs";import{toPromise as v,take as x,filter as q,share as w,map as b,tap as O,merge as E,mergeMap as _,takeUntil as P,make as S,onPush as M,makeSubject as j,subscribe as R,onEnd as A,onStart as D,publish as Q,switchMap as L,fromValue as N}from"wonka";function T(e,n){if(Array.isArray(e))for(var r=0;r<e.length;r++)T(e[r],n);else if("object"==typeof e&&null!==e)for(var t in e)"__typename"===t&&"string"==typeof e[t]?n[e[t]]=0:T(e[t],n);return n}function F(e){return Object.keys(T(e,{}))}var I=function(e){if(e.selectionSet&&!e.selectionSet.selections.some((function(e){return e.kind===n.FIELD&&"__typename"===e.name.value&&!e.alias})))return o({},e,{selectionSet:o({},e.selectionSet,{selections:e.selectionSet.selections.concat([{kind:n.FIELD,name:{kind:n.NAME,value:"__typename"}}])})})},G=new Map;function J(n){var r=t(n),o=G.get(r.__key);return o||((o=e(r,{Field:I,InlineFragment:I})).__key=r.__key,G.set(r.__key,o)),o}function U(e){return e&&"object"==typeof e?Object.keys(e).reduce((function(n,r){var t=e[r];return"__typename"===r?Object.defineProperty(n,"__typename",{enumerable:!1,value:t}):n[r]=Array.isArray(t)?t.map(U):t&&"object"==typeof t&&"__typename"in t?U(t):t,n}),{}):e}function V(e){return e.toPromise=function(){return v(x(1)(q((function(e){return!e.stale}))(e)))},e}function $(e,n,r){return r||(r=n.context),{key:n.key,query:n.query,variables:n.variables,kind:e,context:r}}function z(e,n){return $(e.kind,e,o({},e.context,{meta:o({},e.context.meta,n)}))}function B(){}function H(e,r,t){for(var o=0;o<t.length;o++)if(t[o].kind===n.FRAGMENT_DEFINITION){var u=t[o].name.value,a=i(t[o]);e.has(u)||(e.set(u,a),r.push(t[o]))}else r.push(t[o])}function K(){for(var e=arguments,r=new Map,o=[],i=[],u=Array.isArray(arguments[0])?arguments[0][0]:arguments[0]||"",a=1;a<arguments.length;a++){var c=e[a];c&&c.definitions?i.push.apply(i,c.definitions):u+=c,u+=e[0][a]}return H(r,o,t(u).definitions),H(r,o,i),t({kind:n.DOCUMENT,definitions:o})}function W(e){var n=e.kind;return"subscription"!==n&&"query"!==n}function X(e){var n={},r=[];function t(e){r.push(e.operation.key),1===r.length&&Promise.resolve().then((function(){for(var e;e=r.shift();)n[e]=null}))}function o(e){return!W(e)&&null!=n[e.key]}var i=function(r){var i=r.client,a=r.forward;return function(r){var c=e&&"boolean"==typeof e.isClient?!!e.isClient:!i.suspense,s=w(r),f=a(q((function(e){return!o(e)}))(s)),p=b((function(e){var r,t,o;return t=(r=n[e.key]).error,{operation:e,data:(o=r.data)?JSON.parse(o):void 0,extensions:void 0,error:t?new u({networkError:t.networkError?new Error(t.networkError):void 0,graphQLErrors:t.graphQLErrors&&t.graphQLErrors.length?t.graphQLErrors:void 0}):void 0}}))(q((function(e){return o(e)}))(s));return c?p=O(t)(p):f=O((function(e){var r=e.operation;if(!W(r)){var t=function(e){var n=e.data,r=e.error,t={};return void 0!==n&&(t.data=JSON.stringify(n)),r&&(t.error={graphQLErrors:r.graphQLErrors.map((function(e){return e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message}))},r.networkError&&(t.error.networkError=""+r.networkError)),t}(e);n[r.key]=t}}))(f),E([f,p])}};return i.restoreData=function(e){for(var r in e)null!==n[r]&&(n[r]=e[r])},i.extractData=function(){var e={};for(var r in n)null!=n[r]&&(e[r]=n[r]);return e},e&&e.initialState&&i.restoreData(e.initialState),i}function Y(e){var n=e.kind;return"mutation"!==n&&"query"!==n}function Z(e){var n=e.forward,r=e.client,t=new Map,i=Object.create(null);function u(e){var n=$(e.kind,e);return n.query=J(e.query),n}function a(e){var n=e.context.requestPolicy;return"query"===e.kind&&"network-only"!==n&&("cache-only"===n||t.has(e.key))}return function(e){var c=w(e),s=b((function(e){var n=t.get(e.key),i=o({},n,{operation:z(e,{cacheOutcome:n?"hit":"miss"})});return"cache-and-network"===e.context.requestPolicy&&(i.stale=!0,ee(r,e)),i}))(q((function(e){return!Y(e)&&a(e)}))(c)),f=O((function(e){var n=e.operation;if(n){var o=F(e.data).concat(n.context.additionalTypenames||[]);if("mutation"===e.operation.kind){for(var u=new Set,a=0;a<o.length;a++){var c=o[a],s=i[c]||(i[c]=new Set);s.forEach((function(e){u.add(e)})),s.clear()}u.forEach((function(e){t.has(e)&&(n=t.get(e).operation,t.delete(e),ee(r,n))}))}else if("query"===n.kind&&e.data){t.set(n.key,e);for(var f=0;f<o.length;f++){var p=o[f];(i[p]||(i[p]=new Set)).add(n.key)}}}}))(n(q((function(e){return"query"!==e.kind||"cache-only"!==e.context.requestPolicy}))(b((function(e){return z(e,{cacheOutcome:"miss"})}))(E([b(u)(q((function(e){return!Y(e)&&!a(e)}))(c)),q((function(e){return Y(e)}))(c)])))));return E([s,f])}}function ee(e,n){return e.reexecuteOperation($(n.kind,n,o({},n.context,{requestPolicy:"network-only"})))}function ne(e){var n=e.forwardSubscription,t=e.enableAllOperations;return function(e){var i=e.client,u=e.forward;function a(e){var n=e.kind;return"subscription"===n||!!t&&("query"===n||"mutation"===n)}return function(e){var t=w(e),f=_((function(e){var u=e.key,a=q((function(e){return"teardown"===e.kind&&e.key===u}))(t);return P(a)(function(e){var t=n({key:e.key.toString(36),query:r(e.query),variables:e.variables,context:o({},e.context)});return S((function(n){var r,o=n.next,u=n.complete,a=!1;return Promise.resolve().then((function(){a||(r=t.subscribe({next:function(n){return o(c(e,n))},error:function(n){return o(s(e,n))},complete:function(){a||(a=!0,"subscription"===e.kind&&i.reexecuteOperation($("teardown",e,e.context)),u())}}))})),function(){a=!0,r&&r.unsubscribe()}}))}(e))}))(q(a)(t)),p=u(q((function(e){return!a(e)}))(t));return E([f,p])}}}function re(e){var n=e.forward;return function(e){return n(e)}}function te(e){var n=e.forward,r=new Set;function t(e){var n=e.key,t=e.kind;if("teardown"===t)return r.delete(n),!0;if("query"!==t&&"subscription"!==t)return!0;var o=r.has(n);return r.add(n),!o}function o(e){r.delete(e.operation.key)}return function(e){var r=q(t)(e);return O(o)(n(r))}}function oe(e){var n=e.forward;return function(e){var r=w(e),t=_((function(e){var n=e.key,t=q((function(e){return"teardown"===e.kind&&e.key===n}))(r),o=p(e),i=l(e,o),u=y(e,o);return M((function(e){}))(P(t)(d(e,i,u)))}))(q((function(e){return"query"===e.kind||"mutation"===e.kind}))(r)),o=n(q((function(e){return"query"!==e.kind&&"mutation"!==e.kind}))(r));return E([t,o])}}function ie(e){return function(e){return q((function(){return!1}))(O((function(e){}))(e))}}var ue=ie();function ae(e){return function(n){var r=n.client;return e.reduceRight((function(e,n){return n({client:r,forward:e,dispatchDebug:function(e){}})}),n.forward)}}function ce(e){var n=e.onError;return function(e){var r=e.forward;return function(e){return O((function(e){var r=e.error;r&&n(r,e.operation)}))(r(e))}}}var se=[te,Z,oe],fe=function e(n){var r=new Map,t=new Map,i=[],u=j(),a=u.source,c=u.next,s=!1;function f(e){for(s=!0,e&&c(e);e=i.shift();)c(e);s=!1}function p(e){var n=q((function(n){return n.operation.kind===e.kind&&n.operation.key===e.key}))(m);if(y.maskTypename&&(n=b((function(e){return o({},e,{data:U(e.data)})}))(n)),"mutation"===e.kind)return x(1)(D((function(){return f(e)}))(n));var u=w(A((function(){r.delete(e.key),t.delete(e.key);for(var n=i.length-1;n>=0;n--)i[n].key===e.key&&i.splice(n,1);f($("teardown",e,e.context))}))(D((function(){t.set(e.key,u)}))(M((function(n){r.set(e.key,n)}))(L((function(n){return"query"!==e.kind||n.stale?N(n):E([N(n),b((function(){return o({},n,{stale:!0})}))(x(1)(q((function(n){return"query"===n.kind&&n.key===e.key&&"cache-only"!==n.context.requestPolicy}))(a)))])}))(P(q((function(n){return"teardown"===n.kind&&n.key===e.key}))(a))(n))))));return u}var l=this instanceof e?this:Object.create(e.prototype),y=o(l,{url:n.url,fetchOptions:n.fetchOptions,fetch:n.fetch,suspense:!!n.suspense,requestPolicy:n.requestPolicy||"cache-first",preferGetMethod:!!n.preferGetMethod,maskTypename:!!n.maskTypename,operations$:a,reexecuteOperation:function(e){("mutation"===e.kind||t.has(e.key))&&(i.push(e),s||Promise.resolve().then(f))},createOperationContext:function(e){return e||(e={}),o({},{url:y.url,fetchOptions:y.fetchOptions,fetch:y.fetch,preferGetMethod:y.preferGetMethod},e,{suspense:e.suspense||!1!==e.suspense&&y.suspense,requestPolicy:e.requestPolicy||y.requestPolicy})},createRequestOperation:function(e,n,r){return $(e,n,y.createOperationContext(r))},executeRequestOperation:function(e){if("mutation"===e.kind)return p(e);var n=t.get(e.key)||p(e),i="cache-and-network"===e.context.requestPolicy||"network-only"===e.context.requestPolicy;return S((function(t){return R(t.next)(A(t.complete)(D((function(){var n=r.get(e.key);if("subscription"===e.kind)return f(e);i&&f(e),null!=n&&n===r.get(e.key)?t.next(i?o({},n,{stale:!0}):n):i||f(e)}))(n))).unsubscribe}))},executeQuery:function(e,n){var r=y.createRequestOperation("query",e,n);return y.executeRequestOperation(r)},executeSubscription:function(e,n){var r=y.createRequestOperation("subscription",e,n);return y.executeRequestOperation(r)},executeMutation:function(e,n){var r=y.createRequestOperation("mutation",e,n);return y.executeRequestOperation(r)},query:function(e,n,r){return r&&"boolean"==typeof r.suspense||(r=o({},r,{suspense:!1})),V(y.executeQuery(k(e,n),r))},readQuery:function(e,n,r){var t=null;return R((function(e){t=e}))(y.query(e,n,r)).unsubscribe(),t},subscription:function(e,n,r){return y.executeSubscription(k(e,n),r)},mutation:function(e,n,r){return V(y.executeMutation(k(e,n),r))}}),d=B,v=ae(void 0!==n.exchanges?n.exchanges:se),m=w(v({client:y,dispatchDebug:d,forward:ie()})(a));return Q(m),y},pe=fe;export{fe as Client,Z as cacheExchange,ae as composeExchanges,pe as createClient,re as debugExchange,te as dedupExchange,se as defaultExchanges,ce as errorExchange,ue as fallbackExchangeIO,oe as fetchExchange,J as formatDocument,K as gql,$ as makeOperation,U as maskTypename,X as ssrExchange,ne as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
